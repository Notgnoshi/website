<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="An exploration of submodules" />
        <title>Git: Submodules</title>
        <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
            integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
            crossorigin="anonymous"
        />
        <link rel="stylesheet" href="https://static.agill.xyz/css/common.css" />
        <link rel="shortcut icon" type="image/png" href="https://static.agill.xyz/images/favicon.png" />
        <script
            defer
            src="https://static.agill.xyz/js/highlight.min.js"
            onload="hljs.initHighlightingOnLoad();"
        ></script>
        <link rel="stylesheet" href="https://static.agill.xyz/css/ascetic.min.css" />

        <link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css" />
        <script
            defer
            src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
            integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
            crossorigin="anonymous"
        ></script>
        <script
            defer
            src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"
        ></script>
        <script
            defer
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"
        ></script>
        <script
            defer
            src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"
            onload="Toc.init({$nav: $('#toc'), $scope: $(['h1', 'h2', 'h3'])});"
        ></script>
        <script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>
    </head>
    <body class="d-flex flex-column">
        <header class="bg-dark sticky-top mb-3">
            <nav class="container navbar navbar-expand-lg navbar-dark">
                <a class="navbar-brand" href="/">agill.xyz</a>
                <div class="toggleable-content text-right">
                    <a href="#" class="menu-icon text-muted"><span class="navbar-toggler-icon"></span></a>
                    <div class="trigger navbar-nav">
                        <a class="nav-item nav-link" href="/">Home</a>
                        <a class="nav-item nav-link" href="/research">Research</a>
                        <a class="nav-item nav-link" href="https://mc.agill.xyz">Minecraft</a>
                        <a class="text-muted p-2" href="https://github.com/Notgnoshi"><i class="fab fa-github"></i></a>
                        <a class="text-muted p-2" href="https://twitter.com/notgnoshi"
                            ><i class="fab fa-twitter"></i
                        ></a>
                        <a class="text-muted p-2" href="mailto://Notgnoshi@gmail.com"
                            ><i class="fas fa-envelope"></i
                        ></a>
                    </div>
                </div>
            </nav>
        </header>
        <div class="container flex-grow-1">
            <div class="row">
                <div class="col-sm-2">
                    <nav id="toc" data-toggle="toc" class="sticky-top"></nav>
                </div>
                <div class="col-sm-10">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">Home</a></li>
                            <li class="breadcrumb-item"><a href="/git">Git</a></li>
                            <li class="breadcrumb-item active" area-current="page">
                                <a href="/git/submodules">Submodules</a>
                            </li>
                        </ol>
                    </nav>
                    <h1>Git: Submodules</h1>
                    <h2>What <em>is</em> a submodule?</h2>
                    <a href="https://git-scm.com/docs/gitsubmodules" target="_blank"
                        >https://git-scm.com/docs/gitsubmodules</a
                    >
                    and
                    <a href="https://git-scm.com/docs/git-submodule" target="_blank"
                        >https://git-scm.com/docs/git-submodule</a
                    >
                    <h2>How to add a new submodule</h2>
                    <div class="alert alert-warning">
                        Specify path. Add remote tracking branch. Note that it is <em>not</em> sufficient to add
                        <code>.gitmodules</code> (and why) <b>Do this in its own commit!</b>
                    </div>
                    <h3>HTTPS vs SSH submodule URLs</h3>
                    <p>
                        See
                        <a
                            href="https://stackoverflow.com/questions/6031494/git-submodules-and-ssh-access"
                            target="_blank"
                            >https://stackoverflow.com/questions/6031494/git-submodules-and-ssh-access</a
                        >
                        for justification. I see three options:
                    </p>
                    <ol>
                        <li>Use relative URLs</li>
                        <li>Use HTTPS</li>
                        <li>Use SSH</li>
                    </ol>
                    <p>
                        The right answer depends on your use case. In a corporate environment, it may be acceptable (or
                        even preferable) to force developers to use SSH keys. For a public project, this could
                        potentially be frustrating for users of your project.
                    </p>
                    <div class="alert alert-warning">Show how to recursively change submodules to use SSH URLs.</div>
                    <h3>How <em>not</em> to add a new submodule</h3>
                    <div class="alert alert-danger">
                        Do <b>not</b> run
                        <pre class="language-bash pl-3"><code>git submodule add $URL $PATH
# Do some more work
# Get confused
git restore --staged $PATH
# Get more confused
git add $PATH
git commit</code></pre>
                        This will stage the submodule's <em>contents</em>, not the submodule <code>gitlink</code>.
                    </div>
                    <div class="alert alert-warning">Verify this</div>
                    <h2>How to update a submodule to a new version</h2>
                    <div class="alert alert-warning">
                        Include <code>git -P diff --submodule</code> and <code>git -P show --submodule</code> and using
                        <code>:read !git -P diff --staged --submodule</code> when committing a submodule update. Include
                        encouragement to update submodules in standalone commits. This makes it <em>far</em> easier to
                        rebase a feature branch onto other branches that have updated the same submodule.
                    </div>
                    <h2>How is the submodule laid out on the file system?</h2>
                    <div class="alert alert-warning">
                        <ul>
                            <li>
                                <code>.gitmodules</code>
                                <a href="https://git-scm.com/docs/gitmodules" target="_blank"
                                    >https://git-scm.com/docs/gitmodules</a
                                >
                            </li>
                            <li><code>path/to/submodule</code> (<b>gitlink</b>s)</li>
                            <li><code>path/to/submodule/.git</code></li>
                            <li><code>.git/modules/path/to/submodule</code></li>
                            <li><code>.git/config</code></li>
                        </ul>
                    </div>
                    <h2>How to resolve submodule merge conflicts when rebasing</h2>
                    <h2>How to move a submodule</h2>
                    <div class="alert alert-warning">
                        To change the submodule name or not? Implications for rebasing, checking out old commits.
                    </div>
                    <h2>How to extract a subdirectory as a submodule</h2>
                    <p>
                        Imagine the scenario where you start with a library in the superproject, but then want to
                        extract it as its own project some time later.<label
                            for="sn-monorepo"
                            class="margin-toggle sidenote-number"
                        ></label
                        ><input type="checkbox" id="sn-monorepo" class="margin-toggle" />
                        <span class="sidenote"
                            >This is my recommendation &mdash; you <em>never</em> have clarity on the appropriate
                            superproject/subproject divisions until afterwards. You should avoid the
                            <em>everything is its own microservice</em> pitfall until your monolith ages enough that the
                            separation points become clear.</span
                        >
                        Unfortunately, you cannot replace an existing directory with a submodule of the same name.
                        That's just the way it is. But I prefer to put submodules in one of
                    </p>
                    <ul>
                        <li><code>dependencies/</code></li>
                        <li><code>submodules/</code></li>
                        <li><code>thirdparty/</code></li>
                    </ul>
                    <p>
                        located in the superproject root anyways, so unless your non-submodule shareable subproject
                        originated there, it's preferable to move it anyways.
                    </p>
                    <div class="alert alert-warning">
                        Show how to generate the patch files, and rewrite the paths to export a subdir (following
                        renames) as its own project. Determine if there's a better way with <code>filter-branch</code>
                    </div>
                </div>
            </div>
        </div>
        <script>
            anchors.add();
        </script>
    </body>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css" crossorigin="anonymous" />
</html>
